name: Build and Push Jenkins Master Running on Linux Docker Images to ECR

on:
  push:
    branches:
      - main
      - staging
    paths:
      - 'images/docker/jenkins/master/linux-runtime/**'
jobs:
  build-master-linux-runtime:
    uses: ./.github/workflows/reusable-build-and-push-docker-images.yml
    with:
      dockerfile_dir: images/docker/jenkins/master/linux-runtime
      image_config_file: images/docker/jenkins/master/linux-runtime/image-config.yml
      ansible_playbook_dir: configuration/ansible/playbooks/docker/jenkins/
      ansible_playbook_file_name: build-push-docker-images.yml
      ecr_repo: jenkins/master
      environment_name: ${{ github.ref == 'refs/heads/main' && 'production' || github.ref == 'refs/heads/staging' && 'staging' }}
    secrets: 
      env_file_contents: ${{ secrets.ENV_FILE_CONTENTS_JENKINS_MASTER_LINUX_RUNTIME}}
      aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID}}
      aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      aws-region: ${{ secrets.AWS_DEFAULT_REGION }}
