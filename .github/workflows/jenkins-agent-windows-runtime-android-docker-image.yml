name: Build and Push Android Docker Image of Jenkins Agent Running in windows targeted at android to ECR

on:
  push:
    branches:
      - main
    paths:
      - 'images/docker/jenkins/agent/windows-runtime/android/**'
      - 'images/docker/jenkins/agent/windows-runtime/docker_layers/**'
  
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to build (default: staging)'
        required: false
        default: 'development'

jobs:
  build-agent-windows-runtime:
    uses: ./.github/workflows/reusable-build-and-push-docker-images.yml
    with:
      dockerfile_dir: "images/docker/jenkins/agent/windows-runtime/android"
      image_config_file: 'images/docker/jenkins/agent/windows-runtime/android/image-config.yml'
      ansible_playbook_dir: 'configuration/ansible/playbooks/docker/jenkins/'
      ansible_playbook_file_name: 'build-push-docker-images.yml'
      ecr_repo: 'jenkins/agent/android'
      environment_name: ${{ github.ref == 'refs/heads/main' && 'production' || github.ref == 'refs/heads/staging' && 'staging' }}
      target_service: 'jenkins_agent_windows'
      docker_runtime_os: 'windows' 
    secrets:
      env_file_contents: ${{ secrets.ENV_FILE_CONTENTS_JENKINS_AGENT_WINDOWS_RUNTIME_ANDROID}}
      aws_access_key_id: ${{ secrets.AWS_ACCESS_KEY_ID}}
      aws_secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      aws_region: ${{ secrets.AWS_DEFAULT_REGION }}
      lfg_nw_static_ip: ${{ secrets.LFG_NW_STATIC_IP }}
      lfg_ansible_managed_node_port: ${{secrets.LFG_ANSIBLE_MANAGED_NODE_PORT}}
      lfg_ansible_managed_node_user: ${{secrets.LFG_ANSIBLE_MANAGED_NODE_USER}}
      lfg_ansible_managed_node_pass: ${{secrets.LFG_ANSIBLE_MANAGED_NODE_PASS}}

